params {
    study_id = "${STUDY}"
    tsv_file = "${PROJECT_DIR}/metadata/${STUDY}_normal_one_per_patient_matched_selected_germl_samples.tsv"
    outdir = "${PROJECT_DIR}/analysis/germline"
    chrom_list = "${baseDir}/assets/grch38_chromosome.txt"
    post_process_only = false
    summarise_results = true
    samples_to_process = -1
    run_mode = "sort_inputs"
    run_coord_sort_cram = true
    run_deepvariant = false
    run_haplotypecaller = true
    run_markDuplicates = true
    baitset = "/lustre/scratch127/casm/projects/dermatlas/resources/baitset/GRCh38_WES5_canonical_pad100.merged.bed"
    reference_genome = "/lustre/scratch127/casm/projects/dermatlas/references/germline/genome.fa"
    vep_cache = "/lustre/scratch127/casm/projects/dermatlas/references/vep/cache/103"
    custom_files = "/lustre/scratch127/casm/projects/dermatlas/references/vep/cosmic/v97/CosmicV97Coding_Noncoding.normal.counts.vcf.gz{,.tbi};/lustre/scratch127/casm/projects/dermatlas/references/vep/clinvar/20230121/clinvar_20230121.chr.canonical.vcf.gz{,.tbi};/lustre/scratch127/casm/projects/dermatlas/references/vep/dbsnp/155/dbSNP155.GRCh38.GCF_000001405.39.mod.vcf.gz{,.tbi};/lustre/scratch127/casm/projects/dermatlas/references/vep/gnomad/v3.1.2/gnomad.genomes.v3.1.2.short.vcf.gz{,.tbi}"
    custom_args = "CosmicV97Coding_Noncoding.normal.counts.vcf.gz,Cosmic,vcf,exact,0,CNT;clinvar_20230121.chr.canonical.vcf.gz,ClinVar,vcf,exact,0,CLNSIG,CLNREVSTAT;dbSNP155.GRCh38.GCF_000001405.39.mod.vcf.gz,dbSNP,vcf,exact,0;gnomad.genomes.v3.1.2.short.vcf.gz,gnomAD,vcf,exact,0,FLAG,AF"
    nih_germline_resource = "/lustre/scratch127/casm/projects/dermatlas/resources/germline/national_genomic_test_germline_cancer_genes/output/Cancer_national_genomic_test_directory_v7.2_June_2023_gene_smv_summary.tsv"
    cancer_gene_census_resource = "/lustre/scratch127/casm/projects/dermatlas/resources/COSMIC/cancer_gene_census.v97.genes.tsv"
    flag_genes = "/lustre/scratch127/casm/projects/dermatlas/resources/germline/FLAG_genes_maftools.tsv"
    species = "homo_sapiens"
    filter_col = "gnomAD_AF"
    db_version = "103"
    assembly = "GRCh38"
    samples_to_process = -1
    publish_intermediates = false
    alternative_transcripts = "/lustre/scratch127/casm/projects/dermatlas/resources/ensembl/dermatlas_noncanonical_transcripts_ens103.v2.tsv"
   
}

process { 
  withName: remap_cram {
    container  = 'file:///software/hgi/containers/oqfe_remap.sif'
    cpus = 6
    maxRetries = 3
    stageInMode = 'copy'
    memory = '18G'
    time='600m'
  }
  withName: sort_cram {
    container  = 'file:///software/team113/dermatlas/singularity_images/samtools_sambamba.sif'
    cpus = 8
    memory = '18G'
    time='400m'
  }
  withName: markDuplicates {
    container  = 'file:///software/team113/dermatlas/singularity_images/gatk__4.2.6.1.sif'
    errorStrategy = { task.attempt <= 3 ? 'retry' : 'ignore' }
    maxRetries = 3
    memory = '18G'
    cpus = 6
    time='600m'
  }
  withName: coord_sort_cram {
    container  = 'file:///software/team113/dermatlas/singularity_images/sambamba_0.6.4.sif'
    errorStrategy = { (task.attempt <= maxRetries)  ? 'retry' : 'ignore' }
    maxRetries = 3
    memory = '18G'
    cpus = 8
    time='600m'
  }
  withName: bam_to_cram {
    container  = 'file:///software/team113/dermatlas/singularity_images/samtools-1.10.sif'
    maxRetries = 3
    memory = '18G'
    cpus = 8
    time='400m'
  }
  withName: deepvariant {
    container  = 'file:///software/team113/dermatlas/singularity_images/deepvariant_0.10_UKB.sif'
    cpus = 2
    memory = '20G'
  }
  withName: gatk_haplotypecaller {
    container  = 'file:///software/team113/dermatlas/singularity_images/gatk__4.2.6.1.sif'
    errorStrategy = 'retry'
    cpus = 6
    memory = '30G'
  }
  withLabel: gatk_steps {
      errorStrategy = { (task.attempt <= maxRetries)  ? 'retry' : 'ignore' }
  }

}